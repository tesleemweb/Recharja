<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Personal Information - Recharja (Dark)</title>
<link rel="stylesheet" href="css/personal-info.css">
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <button class="back-btn" onclick="goBack()">â†</button>
      <div class="header-title">Personal Information</div>
    </div>
    <button class="edit-toggle" id="editToggle" onclick="toggleEdit()">Edit</button>
  </div>

  <!-- Content -->
  <div class="content">
    <!-- KYC Tier Status -->
    <div class="kyc-tier-section">
      <div class="current-tier">
        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 4px; color: var(--muted); font-weight: 600;">Current KYC Level</div>
        <div class="tier-badge">TIER 1 - VTU Services</div>
      </div>
      <div class="tier-limits">
        âœ“ Airtime & Data Purchase<br>
        âœ“ Bill Payments<br>
        âœ“ Transaction limit: â‚¦50,000/day
      </div>
      <button class="upgrade-btn" onclick="showUpgradeInfo()">
        ğŸš€ Upgrade to Tier 2 for Gift Cards
      </button>
    </div>

    <!-- Profile Picture -->
    <div class="profile-picture-section">
      <div class="avatar-container">
        <div class="avatar-display" id="avatarDisplay" onclick="changePhoto()">
          H
          <div class="avatar-overlay">
            <span>ğŸ“· Change Photo</span>
          </div>
        </div>
      </div>
      <button class="change-photo-btn" onclick="changePhoto()">
        ğŸ“¸ Change Profile Picture
      </button>
      <div class="verification-status verified">
        âœ“ Verified Account
      </div>
    </div>

    <!-- TIER 1: Basic Information (Always Available) -->
    <div class="form-section">
      <div class="section-header">
        <span class="section-icon">ğŸ‘¤</span>
        Basic Information
      </div>
      <div class="card">
      
        <div class="form-group">
          <label class="form-label">Full Name <span class="required">*</span></label>
          <div class="input-wrapper">
            <input type="text" class="form-input" id="fullName" value="Hussein Mohammed" disabled>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Username</label>
          <div class="input-wrapper">
            <input type="text" class="form-input" id="username" value="@hussein_rch" disabled>
            <span class="input-icon">ğŸ‘¤</span>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Gender</label>
          <select class="form-input" id="gender" disabled>
            <option value="" selected>Select Gender</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
            <option value="prefer-not">Prefer not to say</option>
          </select>
        </div>
      </div>
    </div>

    <!-- TIER 1: Contact Information -->
    <div class="form-section">
      <div class="section-header">
        <span class="section-icon">ğŸ“§</span>
        Contact Information
      </div>
      <div class="card">
        <div class="form-group">
          <label class="form-label">Email Address <span class="required">*</span></label>
          <div class="input-wrapper">
            <input type="email" class="form-input" id="email" value="hussein@recharja.com" disabled>
            <span class="input-icon verified-icon">âœ“</span>
          </div>
          <div class="verification-status verified">
            âœ“ Verified
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Phone Number <span class="required">*</span></label>
          <div class="input-wrapper">
            <input type="tel" class="form-input" id="phone" disabled>
            <span class="input-icon verified-icon">âœ“</span>
          </div>
          <div class="verification-status verified">
            âœ“ Verified
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Alternative Phone (Optional)</label>
          <div class="input-wrapper">
            <input type="tel" class="form-input" id="altPhone" placeholder="Enter alternative phone number" disabled>
          </div>
        </div>

        <div class="info-box">
          <span class="info-box-icon">â„¹ï¸</span>
          <div class="info-box-text">
            Your email and phone are used for account recovery and important notifications. Keep them updated.
          </div>
        </div>
      </div>
    </div>

    <!-- TIER 2: Banking Information (Gift Cards) -->
    <div class="form-section">
      <div class="section-header">
        <span class="section-icon">ğŸ¦</span>
        Banking Information
        <span class="tier-required" style="background: linear-gradient(135deg, #f093fb, #f5576c);">TIER 2 Required</span>
      </div>
      <div class="card">
        <div class="form-group">
          <label class="form-label">Bank Name <span class="required">*</span></label>
          <select class="form-input" id="bankName" disabled>
            <option value="">Select Bank</option>
            <option value="access">Access Bank</option>
            <option value="gtb" selected>GTBank</option>
            <option value="firstbank">First Bank</option>
            <option value="zenith">Zenith Bank</option>
            <option value="uba">UBA</option>
            <option value="fidelity">Fidelity Bank</option>
            <option value="union">Union Bank</option>
            <option value="sterling">Sterling Bank</option>
            <option value="stanbic">Stanbic IBTC</option>
            <option value="fcmb">FCMB</option>
            <option value="wema">Wema Bank</option>
            <option value="polaris">Polaris Bank</option>
            <option value="kuda">Kuda Bank</option>
            <option value="opay">OPay</option>
            <option value="palmpay">PalmPay</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Account Number <span class="required">*</span></label>
          <div class="input-wrapper">
            <input type="text" class="form-input" id="accountNumber" value="0123456789" maxlength="10" disabled>
            <span class="input-icon verified-icon">âœ“</span>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Account Name <span class="required">*</span></label>
          <input type="text" class="form-input" id="accountName" value="HUSSEIN MOHAMMED" disabled>
          <div class="verification-status verified">
            âœ“ Bank Details Verified
          </div>
        </div>

        <div class="info-box">
          <span class="info-box-icon">â„¹ï¸</span>
          <div class="info-box-text">
            Your bank account is used for withdrawals from gift card transactions. Account name must match your registered name.
          </div>
        </div>
      </div>
    </div>

    <!-- TIER 3: Full KYC Verification (Crypto Trading) -->
    <div class="form-section">
      <div class="section-header">
        <span class="section-icon">ğŸª™</span>
        Full KYC Verification
        <span class="tier-required">TIER 3 Required</span>
      </div>
      <div class="card">
        <div class="form-group locked-group">
          <label class="form-label">ID Type <span class="required">*</span></label>
          <select class="form-input locked" id="idType" disabled>
            <option value="">Select ID Type</option>
            <option value="nin">National ID (NIN)</option>
            <option value="intl_passport">International Passport</option>
            <option value="drivers">Driver's License</option>
            <option value="voters">Voter's Card</option>
          </select>
        </div>

        <div class="form-group locked-group">
          <label class="form-label">ID Number <span class="required">*</span></label>
          <div class="input-wrapper">
            <input type="text" class="form-input locked" id="idNumber" placeholder="Required for Tier 3" disabled>
          </div>
        </div>

        <div class="form-group locked-group">
          <label class="form-label">Residential Address <span class="required">*</span></label>
          <input type="text" class="form-input locked" id="address" placeholder="Street Address" disabled>
        </div>

        <div class="form-group locked-group">
          <label class="form-label">City <span class="required">*</span></label>
          <input type="text" class="form-input locked" id="city" placeholder="City" disabled>
        </div>

        <div class="form-group locked-group">
          <label class="form-label">State <span class="required">*</span></label>
          <select class="form-input locked" id="state" disabled>
            <option value="">Select State</option>
            <option value="lagos">Lagos</option>
            <option value="abuja">Abuja (FCT)</option>
            <option value="kano">Kano</option>
            <option value="rivers">Rivers</option>
            <option value="oyo">Oyo</option>
            <option value="kaduna">Kaduna</option>
            <option value="ogun">Ogun</option>
            <option value="delta">Delta</option>
          </select>
        </div>

        <div class="warning-box info-box">
          <span class="info-box-icon">ğŸ’</span>
          <div class="info-box-text">
            <strong>Upgrade to Tier 3 to unlock:</strong><br>
            â€¢ Crypto Trading (Deposit & Swap to Fiat)<br>
            â€¢ Unlimited transaction limits<br>
            â€¢ Premium support<br>
            â€¢ Advanced trading features
          </div>
        </div>
      </div>
    </div>

    <!-- TIER 3: Crypto Wallet Addresses (Optional) -->
    <div class="form-section">
      <div class="section-header">
        <span class="section-icon">â‚¿</span>
        Crypto Wallet Addresses (Optional)
        <span class="tier-required">TIER 3 Required</span>
      </div>
      <div class="card">
        <div class="tier-badge tier-3" style="margin-bottom:16px;">ğŸ” For External Crypto Withdrawals</div>

        <div class="form-group locked-group">
          <label class="form-label">Bitcoin (BTC) Wallet Address</label>
          <input type="text" class="form-input locked" id="btcWallet" placeholder="Enter your BTC wallet address" disabled>
        </div>

        <div class="form-group locked-group">
          <label class="form-label">USDT (TRC20) Wallet Address</label>
          <input type="text" class="form-input locked" id="usdtWallet" placeholder="Enter your USDT TRC20 wallet address" disabled>
        </div>

        <div class="warning-box">
          <span class="info-box-icon">âš ï¸</span>
          <div class="warning-box-text">
            <strong>Warning:</strong> Double-check wallet addresses before saving. Wrong addresses may result in permanent loss of funds.
          </div>
        </div>
      </div>
    </div>

    <!-- Referral Information (All Tiers) -->
    <div class="form-section">
      <div class="section-header">
        <span class="section-icon">ğŸ</span>
        Referral Information
      </div>
      <div class="card">
        <div class="form-group">
          <label class="form-label">Your Referral Code</label>
          <div class="input-wrapper">
            <input type="text" class="form-input" id="referralCode" value="HUSSEIN2024" disabled readonly style="font-weight:700; color:var(--accent);">
            <button class="input-icon" style="cursor:pointer; background:none; border:none; color:var(--accent); font-size:20px;" onclick="copyReferralCode()" title="Copy code">ğŸ“‹</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Referred By (Optional)</label>
          <input type="text" class="form-input" id="referredBy" placeholder="Enter referrer's code if you have one" disabled>
        </div>

        <div class="info-box">
          <span class="info-box-icon">ğŸ</span>
          <div class="info-box-text">
            Share your referral code and earn rewards when others sign up using your code! Both you and your referral get bonuses.
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" id="actionButtons" style="display:none;">
      <button class="action-btn btn-secondary" onclick="cancelEdit()">âœ• Cancel</button>
      <button class="action-btn btn-primary" id="saveBtn" onclick="saveChanges()"><span class="spinner" id="saveSpinner"></span><span id="saveText">ğŸ’¾ Save Changes</span></button>
    </div>

  </div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <div class="nav-item" data-target="dashboard"><span class="nav-icon">ğŸ </span>Home</div>
  <div class="nav-item" data-target="menu"><span class="nav-icon">ğŸ§­</span>Menu</div>
  <div class="nav-item active" data-target="profile"><span class="nav-icon">ğŸ‘¤</span>Profile</div>
</div>
  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

<script src="js/config.js"></script>
<script>
let isEditMode = false;
let originalData = {};

async function init() {
  // Fetch user data from backend
  await loadUserData();

  saveOriginalData();

  const bioInput = document.getElementById('bio');
  const bioCounter = document.getElementById('bioCounter');
  if(bioInput){
    bioInput.addEventListener('input', function() {
      const length = this.value.length;
      if(bioCounter) bioCounter.textContent = length;
      if (length > 200) { 
        this.value = this.value.substring(0,200); 
        if(bioCounter) bioCounter.textContent = 200; 
      }
    });
  }
}

async function loadUserData() {
  try {
    const res = await fetch(`${BASE_URL}/api/auth/me?page=personal-info`, { credentials: 'include' });
    const data = await res.json();
    if (!data.success) throw new Error('Unable to fetch user data');

    const user = data.user;

    // Populate fields
    document.getElementById('fullName').value = user.name || '';
    document.getElementById('username').value = user.username || '';
    document.getElementById('email').value = user.email || '';

    // Make referral code uppercase
    const referralInput = document.getElementById('referralCode');
    referralInput.value = (user.referralCode || user.referral?.code || '').toUpperCase();
    
    // Verified badge
    const verifiedEls = document.querySelectorAll('.verification-status.verified');
    verifiedEls.forEach(el => {
      if(user.verified){
        el.textContent = 'âœ“ Verified Account';
        el.style.color = '#10b981';
      } else {
        el.textContent = 'Unverified Account';
        el.style.color = '#f87171';
      }
    });

    saveOriginalData(); // Save loaded data for canceling later
  } catch(err) {
    console.error('Error loading user data:', err);
    showToast('âŒ Failed to load user data', true);
  }
}

function saveOriginalData() {
  const inputs = document.querySelectorAll('.form-input');
  inputs.forEach(input => { originalData[input.id] = input.value; });
}

function toggleEdit() {
  // For now, show "coming soon" and don't actually enable editing
  showToast('âœï¸ Edit feature coming soon!', false);
  return; // skip the real edit logic until ready

  // --- Original logic below remains for future use ---
  isEditMode = !isEditMode;
  const editToggle = document.getElementById('editToggle');
  const inputs = document.querySelectorAll('.form-input');
  const actionButtons = document.getElementById('actionButtons');

  if (isEditMode) {
    editToggle.textContent = 'Cancel';
    editToggle.classList.add('save-mode');
    actionButtons.style.display = 'grid';
    inputs.forEach(input => { 
      if (input.id !== 'email' && input.id !== 'phone') input.disabled = false; 
    });
    showToast('âœï¸ Edit mode enabled', false);
  } else {
    cancelEdit();
  }
}


function cancelEdit() {
  isEditMode = false;
  const editToggle = document.getElementById('editToggle');
  const inputs = document.querySelectorAll('.form-input');
  const actionButtons = document.getElementById('actionButtons');

  editToggle.textContent = 'Edit';
  editToggle.classList.remove('save-mode');
  actionButtons.style.display = 'none';

  inputs.forEach(input => { input.disabled = true; if (originalData[input.id] !== undefined) input.value = originalData[input.id]; });

  showToast('âœ• Changes cancelled', false);
}

function saveChanges() {
  showToast('ğŸ’¾ Saving is disabled for now (coming soon)', false);
}

function changePhoto(){ showToast('ğŸ“¸ Photo upload coming soon!', false); }

function goBack(){ 
  if (isEditMode) { 
    if (confirm('You have unsaved changes. Are you sure you want to go back?')) window.history.back(); 
  } else window.history.back(); 
}

function showToast(message, isError = false){
  const toast = document.getElementById('toast'); 
  toast.textContent = message; 
  if(isError) toast.classList.add('error'); else toast.classList.remove('error'); 
  toast.classList.add('show'); 
  setTimeout(()=>{ toast.classList.remove('show'); },3000); 
}


// Bottom nav click navigation
const navItems = document.querySelectorAll('.bottom-nav .nav-item');
navItems.forEach(item => {
  item.addEventListener('click', () => {
    const targetPage = item.getAttribute('data-target');
    if(targetPage) window.location.href = targetPage;
  });
});



// initialize
init();
window.addEventListener('beforeunload', function(e){ if(isEditMode){ e.preventDefault(); e.returnValue = ''; } });
</script>

</body>
</html>
